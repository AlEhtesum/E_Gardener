{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      body {
        background: rgb(2,0,36);
background: radial-gradient(circle, rgba(2,0,36,1) 0%, rgba(218,233,236,1) 0%, rgba(174,193,223,1) 43%);
      }

      .hero {
        width: 100%;
        height: 20vh;
        background-color: #34495e;
        position: relative;
        padding: 0 5%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      nav {
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        padding: 20px 5%;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      nav .logo {
        max-width: 180px;
        width: 100%;
        height: auto;
      }

      nav ul li {
        list-style: none;
        display: inline-block;
        margin-left: 20px;
      }

      nav ul li a {
        text-decoration: none;
        font-size: 20px;
        color: #fff;
      }

      nav ul li a:hover {
        color: #027351;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .container {
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 20px;
      }

      .title {
        font-size: 24px;
        font-weight: bold;
        margin-top: 0%;
        margin-bottom: 0%;
      }

      .icon-cart {
        display: flex;
        align-items: center;
        margin-top: 0%;
        margin-bottom: 0%;
      }

      .icon-cart svg {
        width: 30px;
        height: 30px;
        margin-left: 10px;
      }

      .icon-cart span {
        margin-left: 5px;
        font-size: 18px;
        color: #9f15df;
        font-weight: bold;
      }

      .listProduct,
      .listCart {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .cartTab {
        padding: 20px;
      }

      .cartTab h1 {
        font-size: 24px;
        margin-bottom: 20px;
      }

      .btn {
        display: flex;
        justify-content: space-between;
      }

      .btn button {
        padding: 10px 20px;
        font-size: 16px;
      }

      .listProduct {
        margin-left: 7%;
        margin-right: 7%;
        margin-bottom: 5%;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 80px;
      }

      .listProduct .item {
        background-color: #eeeeee;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
      }

      .listProduct .item img {
        width: 50%;
        height: 50%;
        filter: drop-shadow(0 50px 20px rgba(161, 190, 199, 0.6));
        transition: transform 0.3s ease, filter 0.3s ease; /* Add transition for smooth effect */
      }

      .listProduct .item img:hover {
        transform: scale(1.1); /* Scale up the image */
        filter: drop-shadow(
          0 60px 30px rgba(161, 190, 199, 0.8)
        ); /* Example change on hover */
      }

      .listProduct .item h2 {
        font-weight: 600;
        font-size: large;
      }

      .listProduct .item .price {
        letter-spacing: 7px;
        font-size: small;
        font-weight: bold;
        color: #1fd64d;
      }

      .listProduct .item button {
        background-color: #333235;
        color: #eee;
        border: none;
        padding: 5px 25px;
        /* Adjust padding as needed */
        margin-top: 10px;
        border-radius: 20px;
        width: auto;
        /* Set width to auto to fit the content */
      }

      .cartTab {
        width: 400px;
        background-color: #353432;
        color: #eee;
        position: fixed;
        top: 0;
        right: -400px;
        bottom: 0;
        display: grid;
        grid-template-rows: 70px 1fr 70px;
        transition: 0.5s;
      }

      body.showCart .cartTab {
        right: 0;
      }

      body.showCart .container {
        transform: translateX(-250px);
      }

      .cartTab h1 {
        padding: 20px;
        margin: 0;
        font-weight: 300;
      }

      .cartTab .btn {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
      }

      .cartTab button {
        background-color: #e8bc0e;
        border: none;
        font-family: Poppins;
        font-weight: 500;
        cursor: pointer;
      }

      .cartTab .close {
        background-color: #eee;
      }

      .listCart .item img {
        width: 100%;
      }

      .listCart .item {
        display: grid;
        grid-template-columns: 70px 150px 50px 1fr;
        gap: 10px;
        text-align: center;
        align-items: center;
      }

      .listCart .quantity span {
        display: inline-block;
        width: 30px;
        height: 25px;
        background-color: #eee;
        border-radius: 50%;
        color: #555;
        cursor: pointer;
      }

      .listCart .quantity span:nth-child(2) {
        background-color: transparent;
        color: #eee;
        cursor: auto;
      }

      .listCart .item:nth-child(even) {
        background-color: #eee1;
      }

      .listCart {
        overflow: auto;
      }

      .listCart::-webkit-scrollbar {
        width: 0;
      }

      @media only screen and (max-width: 992px) {
        .listProduct {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media only screen and (max-width: 768px) {
        .listProduct {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>

    <title>Product List</title>
  </head>

  <body>
    <div class="hero">{% include "navbar.html" %}</div>
    <div class="container">
      <div class="title">PRODUCT LIST</div>
      <div class="icon-cart">
        <svg
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 18 20"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 15a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm0 0h8m-8 0-1-4m9 4a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm-9-4h10l2-7H3m2 7L3 4m0 0-.792-3H1"
          />
        </svg>
        <span>0</span>
      </div>
    </div>

    <div class="listProduct">
      <!-- Products will be listed here -->
    </div>

    <div class="cartTab">
      <h1>Product Cart</h1>
      <div class="listCart">
        <!-- Cart items will be listed here -->
      </div>
      <div class="btn">
        <button class="close">CLOSE</button>
        <button class="checkOut">Check Out</button>
      </div>
    </div>
    <!-- Footer -->
    <footer>
      <h4>&copy; 2024 EWU</h4>
    </footer>

    <script type="application/json" id="product-data">
      [
        {
          "id": 1,
          "name": "Jasmine Plant",
          "price": 50,
          "image": "{% static 'images/Jasmine1.jpg' %}"
        },
        {
          "id": 2,
          "name": "Mango Plant",
          "price": 200,
          "image": "{% static 'images/mango.jpg' %}"
        },
        {
          "id": 3,
          "name": "Watering Can",
          "price": 290,
          "image": "{% static 'images/wcan.jpg' %}"
        },
        {
          "id": 4,
          "name": "Plant Pot",
          "price": 200,
          "image": "{% static 'images/pot.jpg' %}"
        },
        {
          "id": 5,
          "name": "Tool set",
          "price": 1000,
          "image": "{% static 'images/toolset.jpg' %}"
        },
        {
          "id": 6,
          "name": "Hand Trowel",
          "price": 200,
          "image": "{% static 'images/trowel.jpg' %}"
        },
        {
          "id": 7,
          "name": "Plant Fertilizer",
          "price": 320,
          "image": "{% static 'images/fgr.jpeg' %}"
        },
        {
          "id": 8,
          "name": "Organic Fertilizer",
          "price": 180,
          "image": "{% static 'images/organic.webp' %}"
        }
      ]
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const productData = JSON.parse(
          document.getElementById("product-data").textContent
        );
        const listProduct = document.querySelector(".listProduct");
        const listCart = document.querySelector(".listCart");
        const iconCart = document.querySelector(".icon-cart span");
        const cartTab = document.querySelector(".cartTab");
        const body = document.body;

        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        function renderProducts() {
          productData.forEach((product) => {
            const item = document.createElement("div");
            item.classList.add("item");
            item.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h2>${product.name}</h2>
                    <div class="price">${product.price.toFixed(2)}</div>
                    <button data-id="${product.id}">ADD TO CART</button>
                `;
            listProduct.appendChild(item);
          });
        }

        function renderCart() {
          listCart.innerHTML = "";
          let totalPrice = 0; // Initialize total price
          cart.forEach((item) => {
            const product = productData.find(
              (product) => product.id === item.id
            );
            const cartItem = document.createElement("div");
            cartItem.classList.add("item");
            cartItem.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <div>${product.name}</div>
                    <div>${product.price.toFixed(2)}</div>
                    <div class="quantity">
                        <span class="decrease" data-id="${item.id}">-</span>
                        <span>${item.quantity}</span>
                        <span class="increase" data-id="${item.id}">+</span>
                    </div>
                `;
            listCart.appendChild(cartItem);
            totalPrice += product.price * item.quantity; // Calculate total price
          });
          iconCart.textContent = cart.reduce(
            (acc, item) => acc + item.quantity,
            0
          );
          localStorage.setItem("cart", JSON.stringify(cart));

          // Display total price in the cart
          const totalPriceElement = document.createElement("div");
          totalPriceElement.classList.add("totalPrice");
          totalPriceElement.textContent = `Total Price: ${totalPrice.toFixed(
            2
          )}`;
          listCart.appendChild(totalPriceElement);
        }

        function updateCart(id, quantity) {
          const item = cart.find((item) => item.id === id);
          if (item) {
            item.quantity += quantity;
            if (item.quantity <= 0) {
              cart = cart.filter((item) => item.id !== id);
            }
          } else if (quantity > 0) {
            cart.push({ id, quantity });
          }
          renderCart();
        }

        listProduct.addEventListener("click", function (event) {
          if (event.target.tagName === "BUTTON") {
            const id = parseInt(event.target.dataset.id);
            updateCart(id, 1);
          }
        });

        listCart.addEventListener("click", function (event) {
          if (event.target.classList.contains("decrease")) {
            const id = parseInt(event.target.dataset.id);
            updateCart(id, -1);
          } else if (event.target.classList.contains("increase")) {
            const id = parseInt(event.target.dataset.id);
            updateCart(id, 1);
          }
        });

        document
          .querySelector(".cartTab .checkOut")
          .addEventListener("click", function () {
            if (cart.length === 0) {
              alert("Your cart is empty!");
              return;
            }
            window.location.href = "/checkout/";
          });

        document
          .querySelector(".icon-cart")
          .addEventListener("click", function () {
            body.classList.toggle("showCart");
          });

        document
          .querySelector(".cartTab .close")
          .addEventListener("click", function () {
            body.classList.remove("showCart");
          });

        renderProducts();
        renderCart();
      });
    </script>
  </body>
</html>
